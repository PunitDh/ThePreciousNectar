<div class="container text-white grid bg-black bg-opacity-40 rounded-lg shadow-xl w-7/12">
<table class="table-fixed">
<th>Name</th>
<th>Price</th>

<th>Quantity</th>

<th>Sub Total</th>
<% sumarr = [] %>
<% @cartlisting.each do |cartlisting| %>
   <% listing = Listing.find_by(id: cartlisting.listing_id) %>
   <tr>
        <td><%= listing.name %></td>
        <% price = listing.price %>
        <td><%= number_to_currency(price/100) %></td>
        <td class="text-center"><%= cartlisting.quantity %></td>
        <td><% subtotal = price/100 * cartlisting.quantity %>
        <% sumarr << subtotal %>
        <%= number_to_currency(subtotal) %></td>
    </tr>
<% end %>
<tr><td colspan=4><hr class="border-black"></td></tr>
<tfoot><tr><td colspan=2></td> <td> <strong class="text-right">Total:</strong></td>
<td>
<% totalprice = sumarr.sum %>
<%= number_to_currency(totalprice) %></td> </tr>

</tfoot>
</table>
<span class="inline">
<input type="submit" value="Update"></span>
<span class="inline"><input type="submit" id="checkout-button" value="Checkout"></span>
</div>

<script type="text/javascript">
    // Create an instance of the Stripe object with your publishable API key
    var stripe = Stripe("<%= Rails.application.credentials.dig(:stripe, :public_key) %>");
    var checkoutButton = document.getElementById("checkout-button");
    checkoutButton.addEventListener("click", function () {
      fetch("/checkout", {
        method: "POST",
      })
        .then(function (response) {
          return response.json();
        })
        .then(function (session) {
          return stripe.redirectToCheckout({ sessionId: session.id });
        })
        .then(function (result) {
          // If redirectToCheckout fails due to a browser or network
          // error, you should display the localized error message to your
          // customer using error.message.
          if (result.error) {
            alert(result.error.message);
          }
        })
        .catch(function (error) {
          console.error("Error:", error);
        });
    });
</script>